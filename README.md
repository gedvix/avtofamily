# Avtofamily Platform

Этот репозиторий содержит исходный код будущей платформы Avtofamily для управления каталогом автомобилей, публикациями и интеграциями с маркетплейсами.

## Состав репозитория

- `backend/` – Django-приложение, которое предоставляет административную панель и REST API для управления автомобилями, особенностями, каналами публикаций и логами выгрузок.

## Быстрый старт для backend

### 1. Создайте виртуальное окружение

```bash
cd backend
python -m venv .venv
source .venv/bin/activate
```

### 2. Установите зависимости

```bash
pip install -e .
```

### 3. Примените миграции и создайте суперпользователя

```bash
python manage.py migrate
python manage.py createsuperuser
```

### 4. Запустите сервер разработки

```bash
python manage.py runserver
```

После запуска административная панель будет доступна по адресу http://127.0.0.1:8000/admin/, а REST API – по адресу http://127.0.0.1:8000/api/.

## Тестирование

Для запуска автотестов используется pytest:

```bash
cd backend
pytest
```

## Дальнейшие шаги

Краткий список ключевых направлений развития:

1. Модуль публикации объявлений на сторонние площадки (av.by, abw.by, onliner.by, Instagram, Telegram и др.) через адаптеры и очереди.
2. Публичный фронтенд (например, Next.js) с SEO-оптимизацией, фильтрами каталога и интеграцией с REST API.
3. Автоматизация эксплуатации: CI/CD, мониторинг, резервное копирование, политика безопасности.

Подробнее план описан в документе [docs/roadmap.md](docs/roadmap.md).

## Работа с медиа и изображениями

### Локальное хранение
По умолчанию изображения сохраняются во внутреннюю папку `backend/media/`. При разработке достаточно убедиться, что каталог существует, либо создать его вручную.

### Хранение в S3
Для production-среды можно включить загрузку файлов в S3-совместимое хранилище (AWS S3, Wasabi, Yandex Object Storage и т.д.). Для этого установите необходимые переменные окружения перед запуском Django:

```bash
export DJANGO_USE_S3_MEDIA=1
export AWS_STORAGE_BUCKET_NAME="my-avtofamily-media"
export AWS_ACCESS_KEY_ID="..."
export AWS_SECRET_ACCESS_KEY="..."
# При необходимости кастомизируйте:
export AWS_S3_REGION_NAME="eu-central-1"
export AWS_S3_ENDPOINT_URL="https://s3.eu-central-1.amazonaws.com"
export AWS_S3_CUSTOM_DOMAIN="cdn.example.com"  # необязательно
```

Если указан `AWS_S3_CUSTOM_DOMAIN`, медиа-URL будут формироваться через этот домен (например, подключённый CDN). Для частных провайдеров можно задать `AWS_S3_ENDPOINT_URL`.

### Оптимизация изображений
Все фотографии, загружаемые через админку или API, автоматически приводятся к JPEG с максимальной стороной 2560 пикселей. Это помогает уменьшить вес страницы и подготовить файлы к публикации на маркетплейсах. В админке отображается превью изображения, что ускоряет проверку контента.
1. Реализовать механизм загрузки изображений в S3-совместимое хранилище и автоматическую оптимизацию.
2. Добавить модуль публикации объявлений на сторонние площадки (av.by, abw.by, onliner.by, Instagram, Telegram и др.) через адаптеры.
3. Создать отдельный frontend (например, на Next.js) с SEO-оптимизацией и интеграцией с REST API.
4. Настроить CI/CD, мониторинг и логи.
